<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ç”Ÿæˆç»©å¿«é€Ÿæ’åºç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 90vw;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #2c3e50);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .scenario-intro {
            background: #fff;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .scenario-intro h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .scenario-intro h2 i {
            color: #3498db;
        }
        
        .scenario-intro .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .feature {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #3498db;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .student-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .student-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            transition: all 0.3s;
        }
        
        .student-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .student-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .student-avatar {
            width: 40px;
            height: 40px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .student-name {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .student-score {
            font-size: 1.2em;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .student-status {
            font-size: 0.9em;
            padding: 4px 12px;
            border-radius: 15px;
            background: #ecf0f1;
            color: #7f8c8d;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }
        
        .btn-secondary {
            background: #ecf0f1;
            color: #2c3e50;
        }
        
        .btn-secondary:hover {
            background: #dfe6e9;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }
        
        .input-group {
            margin: 20px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .slider-container {
            margin: 25px 0;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: #ddd;
            border-radius: 3px;
            outline: none;
            margin: 15px 0;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #3498db;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .visualization {
            position: relative;
            height: 400px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .algorithm-steps {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .step {
            padding: 10px 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            font-size: 0.95em;
        }
        
        .step.active {
            background: #e3f2fd;
            border-left-color: #e74c3c;
            font-weight: 500;
        }
        
        .statistics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .color-pivot {
            background-color: #e74c3c;
        }
        
        .color-comparing {
            background-color: #f39c12;
        }
        
        .color-swapping {
            background-color: #9b59b6;
        }
        
        .color-sorted {
            background-color: #2ecc71;
        }
        
        .color-normal {
            background-color: #3498db;
        }
        
        .algorithm-explanation {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        
        .code-keyword {
            color: #3498db;
        }
        
        .code-function {
            color: #e74c3c;
        }
        
        .code-number {
            color: #2ecc71;
        }
        
        .code-comment {
            color: #7f8c8d;
        }
        
        .highlight {
            background: #fffacd;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .performance {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .performance-item {
            text-align: center;
        }
        
        .performance-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .performance-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal h3 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .close-modal {
            float: right;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #2ecc71;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none;
            z-index: 1001;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š å­¦ç”Ÿæˆç»©å¿«é€Ÿæ’åºç³»ç»Ÿ</h1>
            <p>åº”ç”¨åœºæ™¯ï¼šä½¿ç”¨å¿«é€Ÿæ’åºç®—æ³•å¯¹å­¦ç”Ÿæˆç»©è¿›è¡Œé«˜æ•ˆæ’åºå’Œç»Ÿè®¡åˆ†æ</p>
        </div>
        
        <div class="scenario-intro">
            <h2><i>ğŸ¯</i> åº”ç”¨åœºæ™¯è¯´æ˜</h2>
            <p>æœ¬ç³»ç»Ÿæ¨¡æ‹Ÿå­¦æ ¡æ•™åŠ¡å¤„å¯¹å­¦ç”Ÿè€ƒè¯•æˆç»©è¿›è¡Œæ’åºå’Œåˆ†æçš„è¿‡ç¨‹ã€‚é€šè¿‡å¿«é€Ÿæ’åºç®—æ³•ï¼Œå¯ä»¥é«˜æ•ˆåœ°å¯¹å¤§é‡å­¦ç”Ÿæˆç»©è¿›è¡Œæ’åºï¼ŒåŒæ—¶å¯è§†åŒ–å±•ç¤ºæ’åºè¿‡ç¨‹ï¼Œå¸®åŠ©å­¦ç”Ÿç†è§£ç®—æ³•çš„åŸç†ã€‚</p>
            <div class="features">
                <div class="feature">ğŸ“ æ”¯æŒæ‰¹é‡æ·»åŠ å­¦ç”Ÿæˆç»©æ•°æ®</div>
                <div class="feature">âš¡ ä½¿ç”¨å¿«é€Ÿæ’åºè¿›è¡Œé«˜æ•ˆæ’åº</div>
                <div class="feature">ğŸ‘ï¸ å¯è§†åŒ–å±•ç¤ºæ’åºæ¯ä¸€æ­¥è¿‡ç¨‹</div>
                <div class="feature">ğŸ“Š æä¾›è¯¦ç»†çš„æˆç»©ç»Ÿè®¡åˆ†æ</div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="panel">
                <h2>ğŸ‘¨â€ğŸ“ å­¦ç”Ÿæˆç»©ç®¡ç†</h2>
                <div class="input-group">
                    <label>æ‰¹é‡æ·»åŠ å­¦ç”Ÿæˆç»©ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼Œå¦‚ï¼š85 92 78 88 95ï¼‰</label>
                    <input type="text" id="batchInput" placeholder="è¯·è¾“å…¥æˆç»©ï¼Œå¦‚ï¼š85 92 78 88 95">
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="addScores">
                        <i>â•</i> æ·»åŠ æˆç»©
                    </button>
                    <button class="btn btn-secondary" id="randomScores">
                        <i>ğŸ²</i> éšæœºç”Ÿæˆ
                    </button>
                    <button class="btn btn-success" id="sortScores">
                        <i>âš¡</i> å¼€å§‹æ’åº
                    </button>
                    <button class="btn btn-warning" id="resetScores">
                        <i>ğŸ”„</i> é‡ç½®
                    </button>
                </div>
                
                <div class="student-list" id="studentList">
                    <!-- å­¦ç”Ÿåˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="statistics">
                    <div class="stat-card">
                        <div class="stat-label">å­¦ç”Ÿæ€»æ•°</div>
                        <div class="stat-value" id="totalStudents">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å¹³å‡æˆç»©</div>
                        <div class="stat-value" id="averageScore">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æœ€é«˜åˆ†</div>
                        <div class="stat-value" id="maxScore">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æœ€ä½åˆ†</div>
                        <div class="stat-value" id="minScore">0</div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2>ğŸ” æ’åºè¿‡ç¨‹å¯è§†åŒ–</h2>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color color-pivot"></div>
                        <span>åŸºå‡†å…ƒç´  (Pivot)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-comparing"></div>
                        <span>æ­£åœ¨æ¯”è¾ƒ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-swapping"></div>
                        <span>æ­£åœ¨äº¤æ¢</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-sorted"></div>
                        <span>å·²æ’åºä½ç½®</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-normal"></div>
                        <span>æœªå¤„ç†</span>
                    </div>
                </div>
                
                <div class="slider-container">
                    <label>åŠ¨ç”»é€Ÿåº¦æ§åˆ¶</label>
                    <input type="range" class="slider" id="speedControl" min="100" max="1000" value="300">
                    <div style="display: flex; justify-content: space-between;">
                        <span>æ…¢</span>
                        <span id="speedValue">ä¸­ç­‰</span>
                        <span>å¿«</span>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-secondary" id="stepByStep">
                        <i>â­ï¸</i> å•æ­¥æ‰§è¡Œ
                    </button>
                    <button class="btn btn-secondary" id="pauseResume">
                        <i>â¸ï¸</i> æš‚åœ/ç»§ç»­
                    </button>
                    <button class="btn btn-secondary" id="showAlgorithm">
                        <i>ğŸ“–</i> ç®—æ³•åŸç†
                    </button>
                </div>
                
                <div class="visualization" id="visualization">
                    <!-- å¯è§†åŒ–å›¾è¡¨å°†åœ¨è¿™é‡Œç»˜åˆ¶ -->
                </div>
                
                <div class="performance">
                    <div class="performance-item">
                        <div class="performance-value" id="comparisonCount">0</div>
                        <div class="performance-label">æ¯”è¾ƒæ¬¡æ•°</div>
                    </div>
                    <div class="performance-item">
                        <div class="performance-value" id="swapCount">0</div>
                        <div class="performance-label">äº¤æ¢æ¬¡æ•°</div>
                    </div>
                    <div class="performance-item">
                        <div class="performance-value" id="timeTaken">0ms</div>
                        <div class="performance-label">è€—æ—¶</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <h2>ğŸ“ ç®—æ³•æ­¥éª¤è®°å½•</h2>
            <div class="algorithm-steps" id="algorithmSteps">
                <!-- ç®—æ³•æ­¥éª¤å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
        
        <div class="algorithm-explanation">
            <h2>ğŸ“š å¿«é€Ÿæ’åºç®—æ³•åŸç†</h2>
            <p><strong>å¿«é€Ÿæ’åº</strong>æ˜¯ä¸€ç§é«˜æ•ˆçš„æ’åºç®—æ³•ï¼Œé‡‡ç”¨<strong>åˆ†æ²»æ³•</strong>æ€æƒ³ã€‚å…¶æ ¸å¿ƒæ­¥éª¤ä¸ºï¼š</p>
            <ol style="margin: 15px 0; padding-left: 20px;">
                <li>ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ä½œä¸º<strong>åŸºå‡† (pivot)</strong></li>
                <li>é‡æ–°æ’åˆ—æ•°åˆ—ï¼Œæ‰€æœ‰æ¯”åŸºå‡†å°çš„å…ƒç´ æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰æ¯”åŸºå‡†å¤§çš„å…ƒç´ æ”¾åœ¨åŸºå‡†åé¢</li>
                <li>é€’å½’åœ°å¯¹åŸºå‡†å‰åçš„å­åºåˆ—è¿›è¡Œå¿«é€Ÿæ’åº</li>
            </ol>
            
            <div class="code-block">
                <pre><span class="code-keyword">void</span> <span class="code-function">quick_sort</span>(<span class="code-keyword">int</span> q[], <span class="code-keyword">int</span> l, <span class="code-keyword">int</span> r) {
    <span class="code-keyword">if</span> (l >= r) <span class="code-keyword">return</span>;
    <span class="code-keyword">int</span> i = l - <span class="code-number">1</span>, j = r + <span class="code-number">1</span>, x = q[l + r >> <span class="code-number">1</span>];
    <span class="code-keyword">while</span> (i < j) {
        <span class="code-keyword">do</span> i++; <span class="code-keyword">while</span> (q[i] < x);
        <span class="code-keyword">do</span> j--; <span class="code-keyword">while</span> (q[j] > x);
        <span class="code-keyword">if</span> (i < j) <span class="code-function">swap</span>(q[i], q[j]);
    }
    <span class="code-function">quick_sort</span>(q, l, j);
    <span class="code-function">quick_sort</span>(q, j + <span class="code-number">1</span>, r);
}</pre>
            </div>
            
            <div class="features">
                <div class="feature">
                    <strong>æ—¶é—´å¤æ‚åº¦</strong><br>
                    æœ€å¥½/å¹³å‡: <span class="highlight">O(n log n)</span><br>
                    æœ€å: <span class="highlight">O(nÂ²)</span>
                </div>
                <div class="feature">
                    <strong>ç©ºé—´å¤æ‚åº¦</strong><br>
                    æœ€å¥½/å¹³å‡: <span class="highlight">O(log n)</span><br>
                    æœ€å: <span class="highlight">O(n)</span>
                </div>
                <div class="feature">
                    <strong>ç¨³å®šæ€§</strong><br>
                    <span class="highlight">ä¸ç¨³å®šæ’åºç®—æ³•</span>
                </div>
                <div class="feature">
                    <strong>åº”ç”¨åœºæ™¯</strong><br>
                    å¤§æ•°æ®é‡æ’åº<br>
                    å†…å­˜å—é™ç¯å¢ƒ
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="algorithmModal">
        <div class="modal-content">
            <button class="close-modal" id="closeModal">Ã—</button>
            <h3>ğŸ” å¿«é€Ÿæ’åºç®—æ³•è¯¦è§£</h3>
            <p>æœ¬ç³»ç»Ÿä½¿ç”¨çš„å¿«é€Ÿæ’åºç®—æ³•æ­¥éª¤å¦‚ä¸‹ï¼š</p>
            <ol style="margin: 15px 0; padding-left: 20px;">
                <li>é€‰æ‹©åŸºå‡†å…ƒç´ ï¼š<code>x = q[l + r >> 1]</code>ï¼ˆå–ä¸­é—´å…ƒç´ ï¼‰</li>
                <li>åˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆï¼š<code>i = l - 1</code>, <code>j = r + 1</code></li>
                <li>ç§»åŠ¨ i æŒ‡é’ˆå‘å³ï¼Œç›´åˆ°æ‰¾åˆ°å¤§äºç­‰äºåŸºå‡†çš„å…ƒç´ </li>
                <li>ç§»åŠ¨ j æŒ‡é’ˆå‘å·¦ï¼Œç›´åˆ°æ‰¾åˆ°å°äºç­‰äºåŸºå‡†çš„å…ƒç´ </li>
                <li>å¦‚æœ i < jï¼Œäº¤æ¢ä¸¤ä¸ªå…ƒç´ </li>
                <li>é‡å¤æ­¥éª¤3-5ç›´åˆ° i >= j</li>
                <li>é€’å½’æ’åºå·¦åŠéƒ¨åˆ†ï¼š<code>quick_sort(q, l, j)</code></li>
                <li>é€’å½’æ’åºå³åŠéƒ¨åˆ†ï¼š<code>quick_sort(q, j + 1, r)</code></li>
            </ol>
            <p><strong>ç‰¹ç‚¹ï¼š</strong></p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>ä½¿ç”¨<strong>ä¸­é—´å…ƒç´ </strong>ä½œä¸ºåŸºå‡†ï¼Œé¿å…æœ€åæƒ…å†µ</li>
                <li><strong>do-while</strong>å¾ªç¯ç¡®ä¿è‡³å°‘æ‰§è¡Œä¸€æ¬¡</li>
                <li><strong>æŒ‡é’ˆä»è¾¹ç•Œå¤–å¼€å§‹</strong>ï¼Œç®€åŒ–è¾¹ç•Œå¤„ç†</li>
            </ul>
        </div>
    </div>
    
    <div class="notification" id="notification">
        æ“ä½œæˆåŠŸï¼
    </div>

    <script>
        class StudentScoresSystem {
            constructor() {
                this.scores = [];
                this.students = [];
                this.isSorting = false;
                this.isPaused = false;
                this.speed = 300;
                this.steps = [];
                this.currentStep = 0;
                this.comparisons = 0;
                this.swaps = 0;
                this.startTime = 0;
                
                this.animationQueue = [];
                this.currentAnimation = null;
                
                // DOM å…ƒç´ 
                this.canvas = null;
                this.ctx = null;
                
                this.init();
            }
            
            init() {
                // åˆå§‹åŒ–Canvas
                this.initCanvas();
                
                // ç»‘å®šäº‹ä»¶
                this.bindEvents();
                
                // åˆå§‹æ˜¾ç¤º
                this.updateDisplay();
                this.addStep("ç³»ç»Ÿå·²å°±ç»ªï¼Œè¯·æ·»åŠ å­¦ç”Ÿæˆç»©");
            }
            
            initCanvas() {
                const container = document.getElementById('visualization');
                this.canvas = document.createElement('canvas');
                container.appendChild(this.canvas);
                
                this.ctx = this.canvas.getContext('2d');
                this.resizeCanvas();
                
                window.addEventListener('resize', () => this.resizeCanvas());
            }
            
            resizeCanvas() {
                const container = document.getElementById('visualization');
                this.canvas.width = container.clientWidth;
                this.canvas.height = container.clientHeight;
                
                if (this.scores.length > 0) {
                    this.renderVisualization();
                }
            }
            
            bindEvents() {
                // æŒ‰é’®äº‹ä»¶
                document.getElementById('addScores').addEventListener('click', () => this.addScores());
                document.getElementById('randomScores').addEventListener('click', () => this.generateRandomScores());
                document.getElementById('sortScores').addEventListener('click', () => this.startQuickSort());
                document.getElementById('resetScores').addEventListener('click', () => this.reset());
                
                // æ§åˆ¶äº‹ä»¶
                document.getElementById('stepByStep').addEventListener('click', () => this.stepForward());
                document.getElementById('pauseResume').addEventListener('click', () => this.togglePause());
                document.getElementById('showAlgorithm').addEventListener('click', () => {
                    document.getElementById('algorithmModal').style.display = 'flex';
                });
                
                // æ¨¡æ€æ¡†äº‹ä»¶
                document.getElementById('closeModal').addEventListener('click', () => {
                    document.getElementById('algorithmModal').style.display = 'none';
                });
                
                // é€Ÿåº¦æ§åˆ¶
                document.getElementById('speedControl').addEventListener('input', (e) => {
                    this.speed = 1100 - e.target.value;
                    const speedText = this.speed <= 200 ? 'å¿«' : this.speed <= 500 ? 'ä¸­ç­‰' : 'æ…¢';
                    document.getElementById('speedValue').textContent = speedText;
                });
                
                // æ‰¹é‡è¾“å…¥å›è½¦äº‹ä»¶
                document.getElementById('batchInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.addScores();
                    }
                });
                
                // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
                document.getElementById('algorithmModal').addEventListener('click', (e) => {
                    if (e.target.id === 'algorithmModal') {
                        e.target.style.display = 'none';
                    }
                });
            }
            
            addScores() {
                const input = document.getElementById('batchInput').value.trim();
                if (!input) {
                    this.showNotification('è¯·è¾“å…¥æˆç»©æ•°æ®');
                    return;
                }
                
                const newScores = input.split(' ')
                    .map(score => parseInt(score))
                    .filter(score => !isNaN(score) && score >= 0 && score <= 100);
                
                if (newScores.length === 0) {
                    this.showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„æˆç»©ï¼ˆ0-100ä¹‹é—´çš„æ•°å­—ï¼‰');
                    return;
                }
                
                this.scores.push(...newScores);
                this.updateStudents();
                this.updateDisplay();
                this.addStep(`æ·»åŠ äº† ${newScores.length} ä¸ªå­¦ç”Ÿæˆç»©`);
                
                document.getElementById('batchInput').value = '';
                this.showNotification('æˆç»©æ·»åŠ æˆåŠŸï¼');
            }
            
            generateRandomScores() {
                const count = 10; // é»˜è®¤ç”Ÿæˆ10ä¸ªæˆç»©
                this.scores = Array.from({length: count}, () => 
                    Math.floor(Math.random() * 40) + 60 // ç”Ÿæˆ60-100ä¹‹é—´çš„æˆç»©
                );
                
                this.updateStudents();
                this.updateDisplay();
                this.addStep(`éšæœºç”Ÿæˆäº† ${count} ä¸ªå­¦ç”Ÿæˆç»©`);
                this.showNotification('éšæœºæˆç»©ç”ŸæˆæˆåŠŸï¼');
            }
            
            updateStudents() {
                this.students = this.scores.map((score, index) => {
                    // ç”Ÿæˆå­¦ç”Ÿå§“åï¼ˆæ¨¡æ‹Ÿï¼‰
                    const names = ['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é’±ä¸ƒ', 'å­™å…«', 'å‘¨ä¹', 'å´å', 'éƒ‘åä¸€', 'ç‹åäºŒ'];
                    const name = names[index % names.length] + (index >= names.length ? `-${Math.floor(index/names.length)+1}` : '');
                    
                    // æ ¹æ®æˆç»©è®¾ç½®çŠ¶æ€
                    let status = 'è‰¯å¥½';
                    let statusClass = 'student-status';
                    if (score >= 90) {
                        status = 'ä¼˜ç§€';
                    } else if (score >= 80) {
                        status = 'è‰¯å¥½';
                    } else if (score >= 60) {
                        status = 'åŠæ ¼';
                    } else {
                        status = 'ä¸åŠæ ¼';
                    }
                    
                    return {
                        id: index + 1,
                        name: name,
                        score: score,
                        status: status,
                        statusClass: statusClass,
                        // æ’åºçŠ¶æ€
                        sortState: 'normal' // normal, pivot, comparing, swapping, sorted
                    };
                });
            }
            
            updateDisplay() {
                this.updateStudentList();
                this.updateStatistics();
                this.renderVisualization();
            }
            
            updateStudentList() {
                const container = document.getElementById('studentList');
                container.innerHTML = '';
                
                this.students.forEach((student, index) => {
                    const div = document.createElement('div');
                    div.className = 'student-item';
                    div.innerHTML = `
                        <div class="student-info">
                            <div class="student-avatar">${index + 1}</div>
                            <div>
                                <div class="student-name">${student.name}</div>
                                <div class="${student.statusClass}">${student.status}</div>
                            </div>
                        </div>
                        <div class="student-score">${student.score}åˆ†</div>
                    `;
                    container.appendChild(div);
                });
                
                document.getElementById('totalStudents').textContent = this.students.length;
            }
            
            updateStatistics() {
                if (this.scores.length === 0) {
                    document.getElementById('averageScore').textContent = '0';
                    document.getElementById('maxScore').textContent = '0';
                    document.getElementById('minScore').textContent = '0';
                    return;
                }
                
                const sum = this.scores.reduce((a, b) => a + b, 0);
                const avg = Math.round(sum / this.scores.length);
                const max = Math.max(...this.scores);
                const min = Math.min(...this.scores);
                
                document.getElementById('averageScore').textContent = avg;
                document.getElementById('maxScore').textContent = max;
                document.getElementById('minScore').textContent = min;
            }
            
            renderVisualization() {
                if (this.scores.length === 0) {
                    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    
                    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                    this.ctx.fillStyle = '#7f8c8d';
                    this.ctx.font = '18px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText('è¯·æ·»åŠ å­¦ç”Ÿæˆç»©æ•°æ®', this.canvas.width / 2, this.canvas.height / 2);
                    return;
                }
                
                const ctx = this.ctx;
                const width = this.canvas.width;
                const height = this.canvas.height;
                
                // æ¸…ç©ºç”»å¸ƒ
                ctx.clearRect(0, 0, width, height);
                
                // ç»˜åˆ¶èƒŒæ™¯
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(0, 0, width, height);
                
                // è®¡ç®—æ¡å½¢å›¾å‚æ•°
                const barCount = this.scores.length;
                const maxBarWidth = Math.min(50, width / (barCount * 1.3));
                const spacing = maxBarWidth / 3;
                const totalWidth = barCount * (maxBarWidth + spacing) + spacing;
                const startX = (width - totalWidth) / 2;
                
                const maxScore = Math.max(...this.scores, 100);
                const scale = (height - 80) / maxScore;
                
                // ç»˜åˆ¶æ ‡é¢˜
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('å­¦ç”Ÿæˆç»©æ’åºè¿‡ç¨‹', width / 2, 30);
                
                // ç»˜åˆ¶æ¯ä¸ªæ¡å½¢
                for (let i = 0; i < barCount; i++) {
                    const x = startX + i * (maxBarWidth + spacing);
                    const barHeight = this.scores[i] * scale;
                    const y = height - 40 - barHeight;
                    
                    // æ ¹æ®çŠ¶æ€é€‰æ‹©é¢œè‰²
                    let color;
                    switch(this.students[i].sortState) {
                        case 'pivot':
                            color = '#e74c3c'; // çº¢è‰² - åŸºå‡†å…ƒç´ 
                            break;
                        case 'comparing':
                            color = '#f39c12'; // æ©™è‰² - æ­£åœ¨æ¯”è¾ƒ
                            break;
                        case 'swapping':
                            color = '#9b59b6'; // ç´«è‰² - æ­£åœ¨äº¤æ¢
                            break;
                        case 'sorted':
                            color = '#2ecc71'; // ç»¿è‰² - å·²æ’åº
                            break;
                        default:
                            color = '#3498db'; // è“è‰² - æ­£å¸¸
                    }
                    
                    // ç»˜åˆ¶æ¡å½¢
                    ctx.fillStyle = color;
                    ctx.fillRect(x, y, maxBarWidth, barHeight);
                    
                    // ç»˜åˆ¶è¾¹æ¡†
                    ctx.strokeStyle = '#2c3e50';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(x, y, maxBarWidth, barHeight);
                    
                    // ç»˜åˆ¶æˆç»©æ•°å€¼
                    ctx.fillStyle = '#2c3e50';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(this.scores[i], x + maxBarWidth / 2, y - 5);
                    
                    // ç»˜åˆ¶ç´¢å¼•
                    ctx.fillStyle = '#7f8c8d';
                    ctx.font = '11px Arial';
                    ctx.fillText(`[${i}]`, x + maxBarWidth / 2, height - 25);
                    
                    // å¦‚æœæ˜¯åŸºå‡†å…ƒç´ ï¼Œç»˜åˆ¶ç‰¹æ®Šæ ‡è®°
                    if (this.students[i].sortState === 'pivot') {
                        ctx.beginPath();
                        ctx.arc(x + maxBarWidth / 2, y - 10, 5, 0, Math.PI * 2);
                        ctx.fillStyle = '#e74c3c';
                        ctx.fill();
                    }
                }
                
                // ç»˜åˆ¶åŸºå‡†çº¿ï¼ˆ60åˆ†åŠæ ¼çº¿ï¼‰
                const passLineY = height - 40 - 60 * scale;
                ctx.beginPath();
                ctx.moveTo(startX - 10, passLineY);
                ctx.lineTo(startX + totalWidth + 10, passLineY);
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // ç»˜åˆ¶åŠæ ¼çº¿æ ‡ç­¾
                ctx.fillStyle = '#e74c3c';
                ctx.font = '12px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('åŠæ ¼çº¿ (60åˆ†)', startX + totalWidth + 15, passLineY + 5);
            }
            
            addStep(description) {
                const stepsContainer = document.getElementById('algorithmSteps');
                const stepDiv = document.createElement('div');
                stepDiv.className = 'step';
                stepDiv.textContent = `æ­¥éª¤ ${this.steps.length + 1}: ${description}`;
                stepDiv.dataset.index = this.steps.length;
                
                stepsContainer.appendChild(stepDiv);
                this.steps.push(description);
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                stepsContainer.scrollTop = stepsContainer.scrollHeight;
                
                // æ›´æ–°å½“å‰æ­¥éª¤é«˜äº®
                this.highlightCurrentStep();
            }
            
            highlightCurrentStep() {
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active');
                });
                
                if (this.currentStep > 0) {
                    const currentStepDiv = document.querySelector(`.step[data-index="${this.currentStep - 1}"]`);
                    if (currentStepDiv) {
                        currentStepDiv.classList.add('active');
                    }
                }
            }
            
            async startQuickSort() {
                if (this.scores.length === 0) {
                    this.showNotification('è¯·å…ˆæ·»åŠ å­¦ç”Ÿæˆç»©');
                    return;
                }
                
                if (this.isSorting) {
                    this.showNotification('æ’åºæ­£åœ¨è¿›è¡Œä¸­');
                    return;
                }
                
                this.isSorting = true;
                this.isPaused = false;
                this.comparisons = 0;
                this.swaps = 0;
                this.startTime = Date.now();
                this.currentStep = 0;
                
                // æ¸…ç©ºæ­¥éª¤è®°å½•
                document.getElementById('algorithmSteps').innerHTML = '';
                this.steps = [];
                
                this.addStep("å¿«é€Ÿæ’åºå¼€å§‹");
                this.addStep(`é€‰æ‹©åŸºå‡†å…ƒç´ ç­–ç•¥: å–ä¸­é—´å…ƒç´ ä½œä¸ºåŸºå‡†`);
                
                // å¤‡ä»½åŸå§‹æ•°ç»„ç”¨äºæ˜¾ç¤º
                const originalScores = [...this.scores];
                
                // æ‰§è¡Œå¿«é€Ÿæ’åº
                await this.quickSort(0, this.scores.length - 1);
                
                // æ’åºå®Œæˆ
                this.isSorting = false;
                this.addStep(`æ’åºå®Œæˆï¼æ€»æ¯”è¾ƒæ¬¡æ•°: ${this.comparisons}, æ€»äº¤æ¢æ¬¡æ•°: ${this.swaps}`);
                
                const timeTaken = Date.now() - this.startTime;
                document.getElementById('timeTaken').textContent = `${timeTaken}ms`;
                
                this.showNotification(`æ’åºå®Œæˆï¼è€—æ—¶ ${timeTaken}msï¼Œæ¯”è¾ƒ ${this.comparisons} æ¬¡ï¼Œäº¤æ¢ ${this.swaps} æ¬¡`);
            }
            
            async quickSort(l, r) {
                if (!this.isSorting || l >= r) {
                    if (l === r) {
                        this.students[l].sortState = 'sorted';
                        this.renderVisualization();
                        await this.delay();
                    }
                    return;
                }
                
                // æ›´æ–°çŠ¶æ€æ˜¾ç¤ºå½“å‰å¤„ç†çš„åŒºé—´
                this.addStep(`å¤„ç†åŒºé—´ [${l}, ${r}]ï¼Œå…±æœ‰ ${r - l + 1} ä¸ªå…ƒç´ `);
                
                const i = l - 1, j = r + 1;
                const x = this.scores[Math.floor((l + r) / 2)];
                
                // æ ‡è®°åŸºå‡†å…ƒç´ 
                const pivotIndex = Math.floor((l + r) / 2);
                this.students[pivotIndex].sortState = 'pivot';
                this.addStep(`é€‰æ‹©åŸºå‡†å…ƒç´ : scores[${pivotIndex}] = ${x}`);
                this.renderVisualization();
                await this.delay();
                
                let left = i, right = j;
                
                while (left < right) {
                    // ç§»åŠ¨å·¦æŒ‡é’ˆ
                    do {
                        left++;
                        if (left < right && left !== pivotIndex) {
                            this.students[left].sortState = 'comparing';
                            this.renderVisualization();
                            await this.delay();
                            this.comparisons++;
                        }
                    } while (this.scores[left] < x);
                    
                    // ç§»åŠ¨å³æŒ‡é’ˆ
                    do {
                        right--;
                        if (right > left && right !== pivotIndex) {
                            this.students[right].sortState = 'comparing';
                            this.renderVisualization();
                            await this.delay();
                            this.comparisons++;
                        }
                    } while (this.scores[right] > x);
                    
                    // å¦‚æœæŒ‡é’ˆæœªç›¸é‡ï¼Œäº¤æ¢å…ƒç´ 
                    if (left < right) {
                        this.addStep(`äº¤æ¢ scores[${left}]=${this.scores[left]} å’Œ scores[${right}]=${this.scores[right]}`);
                        
                        this.students[left].sortState = 'swapping';
                        this.students[right].sortState = 'swapping';
                        this.renderVisualization();
                        await this.delay();
                        
                        // äº¤æ¢å…ƒç´ 
                        [this.scores[left], this.scores[right]] = [this.scores[right], this.scores[left]];
                        [this.students[left], this.students[right]] = [this.students[right], this.students[left]];
                        
                        this.swaps++;
                        document.getElementById('swapCount').textContent = this.swaps;
                        
                        // æ¢å¤çŠ¶æ€
                        this.students[left].sortState = 'normal';
                        this.students[right].sortState = 'normal';
                        this.renderVisualization();
                        await this.delay();
                    }
                }
                
                // æ¢å¤åŸºå‡†å…ƒç´ çŠ¶æ€
                this.students[pivotIndex].sortState = 'normal';
                
                // æ ‡è®°åˆ†åŒºå®Œæˆ
                for (let k = l; k <= right; k++) {
                    this.students[k].sortState = 'sorted';
                }
                this.renderVisualization();
                await this.delay();
                
                this.addStep(`åˆ†åŒºå®Œæˆï¼ŒåŸºå‡†å…ƒç´  ${x} å·²åœ¨æ­£ç¡®ä½ç½®`);
                
                // æ›´æ–°æ€§èƒ½ç»Ÿè®¡
                document.getElementById('comparisonCount').textContent = this.comparisons;
                document.getElementById('swapCount').textContent = this.swaps;
                document.getElementById('timeTaken').textContent = `${Date.now() - this.startTime}ms`;
                
                // é€’å½’æ’åºå·¦å³å­åºåˆ—
                await this.quickSort(l, right);
                await this.quickSort(right + 1, r);
            }
            
            stepForward() {
                if (!this.isSorting) {
                    this.showNotification('è¯·å…ˆå¼€å§‹æ’åº');
                    return;
                }
                
                this.isPaused = false;
                // è¿™é‡Œå¯ä»¥å®ç°å•æ­¥æ‰§è¡Œé€»è¾‘
                this.showNotification('å•æ­¥æ‰§è¡ŒåŠŸèƒ½å¼€å‘ä¸­...');
            }
            
            togglePause() {
                if (!this.isSorting) {
                    this.showNotification('æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„æ’åº');
                    return;
                }
                
                this.isPaused = !this.isPaused;
                if (this.isPaused) {
                    this.addStep('æ’åºå·²æš‚åœ');
                    this.showNotification('æ’åºå·²æš‚åœ');
                } else {
                    this.addStep('æ’åºç»§ç»­æ‰§è¡Œ');
                    this.showNotification('æ’åºç»§ç»­æ‰§è¡Œ');
                }
            }
            
            reset() {
                this.isSorting = false;
                this.isPaused = false;
                this.scores = [];
                this.students = [];
                this.steps = [];
                this.currentStep = 0;
                this.comparisons = 0;
                this.swaps = 0;
                
                document.getElementById('algorithmSteps').innerHTML = '';
                document.getElementById('comparisonCount').textContent = '0';
                document.getElementById('swapCount').textContent = '0';
                document.getElementById('timeTaken').textContent = '0ms';
                document.getElementById('batchInput').value = '';
                
                this.updateDisplay();
                this.addStep('ç³»ç»Ÿå·²é‡ç½®ï¼Œè¯·æ·»åŠ æ–°çš„å­¦ç”Ÿæˆç»©');
                this.showNotification('ç³»ç»Ÿå·²é‡ç½®');
            }
            
            delay() {
                return new Promise(resolve => {
                    if (this.isPaused) {
                        // æš‚åœçŠ¶æ€ï¼Œç­‰å¾…æ¢å¤
                        const checkPause = () => {
                            if (!this.isPaused || !this.isSorting) {
                                resolve();
                            } else {
                                setTimeout(checkPause, 100);
                            }
                        };
                        checkPause();
                    } else {
                        setTimeout(resolve, this.speed);
                    }
                });
            }
            
            showNotification(message) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
        }

        // åˆå§‹åŒ–ç³»ç»Ÿ
        document.addEventListener('DOMContentLoaded', () => {
            const system = new StudentScoresSystem();
            window.system = system; // ç”¨äºè°ƒè¯•
        });
    </script>
</body>
</html>